default_prompt: |
  Analyze photo. Return ONLY valid JSON, no text/comments/fences. Keys in exact order shown. Numbers as integers without units.
  
  If NOT food/drink: {"error": "NOT A FOOD"}
  
  If food/drink (including packaged items):
  {"type":"food_processing","dish_name":"<name>","estimated_avg_calories":<int>,"ingredients":["<item>"],"total_avg_weight":<int>,"health_rating":<int>,"food_health_level":{"title":"<4 words max + emoji>","description":"<20 words max>","health_summary":[{"ingredients":"<name + emoji>","description":"<10 words max>","risk":"<5 words, if harmful>","benefit":"<5 words, if healthy>"}]},"contains":{"proteins":<int>,"fats":<int>,"carbohydrates":<int>,"sugar":<int>,"is_alcohol":<bool>}}
  
  Rules:
  - Worst-case nutrition: assume full-fat versions if unclear, all visible oil absorbed, all sauces consumed. Use realistic USDA FoodData Central or NCCDB style values.
  - Weight estimation priority: 1) visible labels, 2) reference objects (plate 28cm, fork 19cm, hand 9cm), 3) culinary standards.
  - health_rating: INTEGER 0-100. Calculate by summing points below (max 100) and applying deductions where relevant.
    * Whole unprocessed: 0..25 (deduct up to 25 if ultra processed or packaged snack).
    * Fresh ripe raw not thermally processed: 0..20 (deduct up to 20 if cooked fried baked).
    * No added spices sauces salt sugar additives preservatives: 0..15 (deduct up to 15 if present or likely).
    * Naturally nutritious and balanced: 0..20 based on fiber vitamins minerals quality protein and fat quality.
      Add points for: fiber >= 6 per meal, high quality protein, unsaturated fats, low saturated fat.
      Deduct for: high added sugar, high saturated fat, low fiber with high calories.
    * Single or simple ingredient: 0..10 (deduct up to 10 if complex processed dish).
    * Not deep fried not ultra processed no hydrogenated fats: 0..10 (deduct up to 10 if deep fried ultra processed).
    Example: ripe fresh raw fruit with no additives should be near 100. Chips should be very low.
    HIGH RATING FOODS (95-100): Pure water, fresh berries (blueberries, strawberries, raspberries, blackberries), fresh vegetables (broccoli, spinach, kale, asparagus, bell peppers, tomatoes, carrots, cauliflower, Brussels sprouts), fresh fruits (apples, avocados, oranges, grapes, kiwi, lemons, mangoes), raw nuts and seeds (almonds, walnuts, chia seeds, macadamia), fresh fish (salmon, sardines, trout, tuna), fresh lean meats (chicken breast, lean beef, lamb), eggs, legumes (lentils, beans), whole grains (brown rice, oats, quinoa), olive oil, garlic, onions.
  - health_summary: each item must be EITHER a risk OR a benefit, not both. SORTING: Always list benefits FIRST, then risks. Order: all items with impact="Benefit" at the top, followed by all items with impact="Risk" at the bottom.
  - Text fields restriction:
    * dish_name and ingredients must be alphanumeric plus spaces only, first letter capitalized.
    * food_health_level title and health_summary ingredient may include emojis.
    * descriptions must be max length as specified.
  - is_alcohol: true for alcoholic drinks.
  - WATER: Pure water (tap, bottled, mineral) always gets health_rating: 100. Zero calories, zero macros except sodium if mineral water. Essential for hydration. ðŸ’§
  - COFFEE: Track coffee consumption. If consumed 2+ times daily, flag for warning in recommendations.

  If food or drink (including packaged items) return:
  {"type":"food_processing",
   "dish_name":"<Name>",
   "estimated_avg_calories":<int>,
   "ingredients":["<Item>"],
   "total_avg_weight":<int>,
   "health_rating":<int>,
   "food_health_level":{
     "title":"<Max 4 words + emoji>",
     "description":"<Max 20 words>",
     "health_summary":[
       {"ingredient":"<Name + emoji>",
        "description":"<Max 10 words>",
        "impact":"Benefit",
        "impact_text":"<Max 5 words + emoji optional>"},
       {"ingredient":"<Name + emoji>",
        "description":"<Max 10 words>",
        "impact":"Risk",
        "impact_text":"<Max 5 words + emoji optional>"}
     ]
   },
   "contains":{
     "proteins":<int>,
     "fats":<int>,
     "carbohydrates":<int>,
     "sugar":<int>,
     "fiber":<int>,
     "saturated_fat":<int>,
     "sodium":<int>,
     "is_alcohol":<bool>
   }
  }

  Notes:
  - Use worst-case assumptions for oils sauces dressings and toppings.
  - Make dish_name and ingredients simple and recognizable.
  - If unsure about an ingredient, include it with lower confidence in description text, not extra JSON keys.
  - CRITICAL SORTING: In health_summary array, ALWAYS put all Benefit items first, followed by all Risk items. Never mix them.

weight_prompt: |
  Extract weight from scale OCR text. JSON only, no extra text.
  - Normalize separators to dot. If missing, last digit is decimal.
  - Valid range: 30-150 kg.
  - Output: {"type":"weight_processing","weight":<number>} or {"error":"INVALID_WEIGHT"}

get_recommendation: |
  JSON only. Analyze food history and provide concise recommendations. Return exactly this structure:
  {
    "foods_to_reduce_or_avoid": [{"dish_name": "<translated>", "reason": "<concise reason, 4-6 words, 1 emoji max>"}],
    "foods_to_reduce_title_color": "red",
    "healthier_foods": [{"dish_name": "<translated>", "reason": "<concise reason, 4-6 words, 1 emoji max>"}],
    "healthier_foods_title_color": "green",
    "general_recommendations": {"<key>": "<brief advice, 3-6 words, 1 emoji max>"},
    "favorite_dish": {"dish_name": "<translated>", "description": "<4-6 words, 1 emoji max>"},
    "recommended_dish": {"cuisine": "<cuisine name>", "dish": "<specific dish name translated>", "description": "<3-5 words>"} OR empty object {},
    "age_based_health_advice": "<targeted advice based on user age, 8-12 words, 1 emoji>",
    "coffee_warning": "<if >=3 coffees/day: max 10 words, 1 emoji, else empty string>",
    "translation_keys": {"foods_to_reduce_or_avoid": "<translated>", "healthier_foods": "<translated>", "general_recommendations": "<translated>", "favorite_dish": "<translated>", "recommended_dish": "<translated>", "age_based_health_advice": "<translated>", "coffee_warning": "<translated>"}
  }
  
  CRITICAL: Keys must stay in English. NEVER translate keys. Translate ONLY values to respond_in_language.
  BREVITY RULES:
  - Maximum 1 emoji per item. No emoji chains.
  - reason: 4-6 words max (e.g., "High sugar, try less ðŸ¬")
  - general_recommendations: 3-6 words per advice
  - 3 items each for foods_to_reduce_or_avoid and healthier_foods
  - 3 key:value pairs for general_recommendations
  - favorite_dish: most eaten healthy dish, 4-6 words
  - recommended_dish: ONLY recommend if dish has health_rating 80+. Pick ONE specific dish from cuisines (Italian: Risotto/Pasta Carbonara, French: Ratatouille/Nicoise Salad, Japanese: Miso Salmon/Sushi, Mediterranean: Greek Salad/Hummus Bowl, Asian: Stir-fry/Pho, Mexican: Fish Tacos/Guacamole). If no dish with rating 80+, return empty object {}.
  SPECIAL RULES:
  - COFFEE WARNING: Show ONLY if >=3 coffees per day (3 or more). Max 10 words. Example: "Too much caffeine, reduce intake â˜•"
  - AGE_BASED_HEALTH_ADVICE: Provide ONE general health advice (8-12 words, 1 emoji) based on evidence from NHS and longevity research. Rotate through these evidence-based tips:
    * Build peak fitness with regular strength training twice weekly ðŸ’ª
    * Maintain consistent sleep schedule for better metabolism ðŸ˜´
    * Do 150min moderate or 75min vigorous activity weekly ðŸš´
    * Include balance and flexibility exercises daily ðŸ§˜
    * Limit alcohol and prioritize hydration throughout day ðŸ’§
    * Focus on whole foods and reduce ultra-processed items ðŸ¥—
  - Use varied advice each time, not always the same tip

respond_in_language: |
  Target language from "respond_in_language" (ISO 639-1). Default: en.
  - JSON keys: English
  - ALL values: target language only (dish names, reasons, recommendations)
  - Include translation_keys mapping

get_recommendation_local: |
  JSON only. One top-level object starting with "{".
  TARGET LANGUAGE from respond_in_language (ISO 639-1). Default: en.
  TRANSLATE keys AND values.
  
  Exactly 3 keys in order:
  1) <reduce_key_translated>: ["Dish: reason", "Dish: reason", "Dish: reason"]
  2) <healthier_key_translated>: ["Dish: reason", "Dish: reason", "Dish: reason"]
  3) <recs_key_translated>: ["recommendation", "recommendation", "recommendation"] (3-6 words each)
  
  - Dish names from Food Table only, translated. No generic words.
  - Arrays contain strings only, not objects.
  - No extra keys, no markdown, no trailing text.
  - Keep text concise: 3-6 words per recommendation, max 1 emoji per item.
